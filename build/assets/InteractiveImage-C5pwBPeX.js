import{r as s,j as e,m as z,J as k}from"./index-C7XHXQ4p.js";const D="#F97316",B="#E5DEFF",F=28,H=13,Z=17,G=32,J=12,U=.55,R=28,X=s.memo(({coord:r,isHighlighted:i,scale:c,circleSize:g,circleFontSize:I,minCircleSize:v,maxCircleSize:p,onMouseEnter:b,onMouseLeave:y,onClick:C})=>{const l=r.number.length>=3,d=r.number.length,w=d>=3?28:0,m=d>=3?15:0,h=d>=3?.45:U,x=Math.max(v*1.2,Math.min(p*1.6,F*h*d*c)),f=Math.max(v,Math.min(p,d>=3?R*c*.9:R*c)),o=(r.x+w)*c,j=(r.y+m)*c;return e.jsx("div",{className:"absolute",style:{left:`${o}px`,top:`${j}px`,transform:"translate(-50%, -50%)",pointerEvents:"auto",zIndex:10},children:e.jsx(z.div,{className:`flex items-center justify-center cursor-pointer ${l?"rounded-md":"rounded-full"}`,style:{width:l?`${x}px`:`${g}px`,height:l?`${f}px`:`${g}px`,fontSize:`${I}px`,backgroundColor:i?D:B,color:i?"white":"#5411a1",border:i?"2px solid #F97316":"none",boxShadow:i?"0 0 0 4px #FFE4BA":void 0,outline:i?"1px solid #FFD580":void 0,fontWeight:i?700:600,padding:l?"0 6px":0,display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"1",textAlign:"center",transition:"background 0.2s, color 0.2s, transform 0.15s",whiteSpace:"nowrap",boxSizing:"border-box"},whileHover:{scale:1.08,transformOrigin:"center center"},animate:{backgroundColor:i?"rgba(249, 115, 22, 1)":"rgba(229, 222, 255, 1)"},onMouseEnter:b,onMouseLeave:y,onClick:C,children:e.jsx("span",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",lineHeight:"1",margin:0,padding:0,textAlign:"center",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:r.number})})})}),V=({imagePath:r,imageData:i,highlightedNumber:c,onCircleHover:g,onCircleClick:I})=>{const[v,p]=s.useState({width:0,height:0}),[b,y]=s.useState(1),[C,l]=s.useState(0),[d,w]=s.useState(!1),[m,h]=s.useState(!1),[x,f]=s.useState(!1),[o,j]=s.useState(0),u=s.useRef(null),n=s.useRef(null),[E,W]=s.useState(!1);s.useEffect(()=>{if(!u.current)return;const t=new IntersectionObserver(a=>{a[0].isIntersecting&&!E&&W(!0)},{threshold:.1});return t.observe(u.current),()=>{t.disconnect()}},[E]),s.useEffect(()=>{if(x&&o<3){const t=setTimeout(()=>{console.log(`Retrying image load attempt ${o+1} for: ${r}`),f(!1),j(a=>a+1)},1e3*(o+1));return()=>clearTimeout(t)}},[x,o,r]),s.useEffect(()=>{const t=()=>{if(n.current&&n.current.naturalWidth){const L=n.current.naturalWidth,_=n.current.clientWidth;y(_/L),l(L),p({width:_,height:n.current.clientHeight})}},a=new ResizeObserver(t);return u.current&&a.observe(u.current),n.current&&n.current.complete&&n.current.naturalWidth&&(t(),h(!0)),()=>{u.current&&a.unobserve(u.current)}},[r,E]),s.useEffect(()=>{const t=()=>{w(window.innerWidth<640)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const M=()=>{if(h(!0),f(!1),n.current&&n.current.naturalWidth){const t=n.current.naturalWidth,a=n.current.clientWidth;y(a/t),l(t),p({width:a,height:n.current.clientHeight})}},T=()=>{console.error("Failed to load image:",r),h(!1),f(!0),o>=3&&k.error("Image could not be loaded after multiple attempts.")},$=()=>{f(!1),h(!1),j(0),n.current&&(n.current.src=`${r}?t=${Date.now()}`)},N=d?J:Z,S=G,A=Math.max(N,Math.min(S,F*b)),O=Math.max(N*.5,Math.min(S*.65,H*b));return x&&o>=3?e.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg w-full h-[400px]",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"üì∑"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Image Failed to Load"}),e.jsxs("p",{className:"text-gray-500 mt-2",children:["Could not load image: ",r]}),e.jsxs("div",{className:"mt-4 p-2 bg-gray-50 rounded text-sm text-gray-600",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Troubleshooting:"})}),e.jsxs("ul",{className:"list-disc pl-5 text-left space-y-1",children:[e.jsx("li",{children:"Check that the image exists in the correct folder"}),e.jsx("li",{children:"Verify the image has a supported extension (.jpg, .jpeg, .png, .webp, .gif)"}),e.jsx("li",{children:"Ensure the filename matches your JSON file name"})]})]}),e.jsx("button",{onClick:$,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try Again"})]})}):e.jsxs("div",{ref:u,className:"relative w-full h-full bg-white rounded-lg min-h-[400px]",children:[!m&&!x&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-custom-blue"}),e.jsx("p",{className:"ml-3 text-gray-500",children:"Loading image..."})]}),E&&e.jsx("img",{ref:n,src:r,alt:i.imageName,className:`w-full h-auto ${m?"opacity-100":"opacity-0"}`,style:{maxWidth:"100%",height:"auto",objectFit:"contain",transition:"opacity 0.3s"},onLoad:M,onError:T,loading:"lazy"}),m&&i.coordinates.map(t=>e.jsx(X,{coord:t,isHighlighted:c===t.number,scale:b,circleSize:A,circleFontSize:O,minCircleSize:N,maxCircleSize:S,onMouseEnter:()=>g(t.number),onMouseLeave:()=>g(null),onClick:a=>{a.preventDefault(),a.stopPropagation(),I(t.number)}},t.id)),m&&i.coordinates.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-90",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"üìç"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600",children:"Interactive Features Disabled"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"No coordinate data available for this image"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"The parts list below still works for navigation"})]})})]})},q=s.memo(V);export{q as default};
